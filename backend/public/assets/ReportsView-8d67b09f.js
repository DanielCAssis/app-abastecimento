import{I as X,a2 as Z,d as h,e as b,f as t,H as T,Q as tt,_ as et,r as d,A as j,o as at,R as N,v as st,V as M,W as K,Y as U,a0 as z,j as G,t as l,h as rt,i as ot,n as it}from"./index-0b450a74.js";var lt={root:{position:"relative"}},nt={root:"p-chart"},ut=X.extend({name:"chart",inlineStyles:lt,classes:nt}),dt={name:"BaseChart",extends:tt,props:{type:String,data:null,options:null,plugins:null,width:{type:Number,default:300},height:{type:Number,default:150},canvasProps:{type:null,default:null}},style:ut,provide:function(){return{$parentInstance:this}}},W={name:"Chart",extends:dt,inheritAttrs:!1,emits:["select","loaded"],chart:null,watch:{data:{handler:function(){this.reinit()},deep:!0},type:function(){this.reinit()},options:function(){this.reinit()}},mounted:function(){this.initChart()},beforeUnmount:function(){this.chart&&(this.chart.destroy(),this.chart=null)},methods:{initChart:function(){var a=this;Z(()=>import("./auto-39f2889c.js"),[]).then(function(r){a.chart&&(a.chart.destroy(),a.chart=null),r&&r.default&&(a.chart=new r.default(a.$refs.canvas,{type:a.type,data:a.data,options:a.options,plugins:a.plugins})),a.$emit("loaded",a.chart)})},getCanvas:function(){return this.$canvas},getChart:function(){return this.chart},getBase64Image:function(){return this.chart.toBase64Image()},refresh:function(){this.chart&&this.chart.update()},reinit:function(){this.initChart()},onCanvasClick:function(a){if(this.chart){var r=this.chart.getElementsAtEventForMode(a,"nearest",{intersect:!0},!1),u=this.chart.getElementsAtEventForMode(a,"dataset",{intersect:!0},!1);r&&r[0]&&u&&this.$emit("select",{originalEvent:a,element:r[0],dataset:u})}},generateLegend:function(){if(this.chart)return this.chart.generateLegend()}}};function S(s){"@babel/helpers - typeof";return S=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},S(s)}function H(s,a){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(s);a&&(u=u.filter(function(D){return Object.getOwnPropertyDescriptor(s,D).enumerable})),r.push.apply(r,u)}return r}function Q(s){for(var a=1;a<arguments.length;a++){var r=arguments[a]!=null?arguments[a]:{};a%2?H(Object(r),!0).forEach(function(u){ct(s,u,r[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):H(Object(r)).forEach(function(u){Object.defineProperty(s,u,Object.getOwnPropertyDescriptor(r,u))})}return s}function ct(s,a,r){return a=vt(a),a in s?Object.defineProperty(s,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[a]=r,s}function vt(s){var a=mt(s,"string");return S(a)=="symbol"?a:String(a)}function mt(s,a){if(S(s)!="object"||!s)return s;var r=s[Symbol.toPrimitive];if(r!==void 0){var u=r.call(s,a||"default");if(S(u)!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}var pt=["width","height"];function gt(s,a,r,u,D,_){return h(),b("div",T({class:s.cx("root"),style:s.sx("root")},s.ptmi("root")),[t("canvas",T({ref:"canvas",width:s.width,height:s.height,onClick:a[0]||(a[0]=function(y){return _.onCanvasClick(y)})},Q(Q({},s.canvasProps),s.ptm("canvas"))),null,16,pt)],16)}W.render=gt;const ft={class:"reports-header"},ht={class:"reports-tabs"},bt=["onClick"],_t={key:0,class:"reports-vehicle-select"},yt=["value"],Dt={class:"reports-content"},wt={key:0},Rt={class:"reports-card"},Ct={class:"reports-card-row"},Ft={class:"reports-card-value"},St={class:"reports-card-value"},kt={class:"reports-card-value"},Lt={class:"reports-card"},Bt={class:"reports-card-row"},Pt={class:"reports-card-value"},Ot={class:"reports-card-value"},xt={class:"reports-card"},$t={class:"reports-card-row"},Et={class:"reports-card-value"},Mt={class:"reports-dropdown-row"},At={class:"reports-chart-placeholder"},Vt={key:1},qt={class:"reports-card"},It={class:"reports-card-row"},Tt={class:"reports-card-value"},jt={class:"reports-card-value"},Nt={class:"reports-card-value"},Kt={class:"reports-card"},Ut={class:"reports-card-row"},zt={class:"reports-card-value"},Gt={class:"reports-card-value"},Ht={class:"reports-card-row reports-card-row-multistats"},Qt={class:"reports-card-value"},Wt={class:"reports-card-value maior"},Yt={class:"reports-card-value menor"},Jt={class:"reports-card"},Xt={class:"reports-card-row"},Zt={class:"reports-card-value"},te={class:"reports-card-value"},ee={class:"reports-card-row reports-card-row-multistats"},ae={class:"reports-card-value"},se={class:"reports-card-value maior"},re={class:"reports-card-value menor"},oe={class:"reports-card-row reports-card-row-multistats"},ie={class:"reports-card-value"},le={class:"reports-card-value menor"},ne={class:"reports-card-value maior"},ue={__name:"ReportsView",setup(s){const a=[{key:"geral",label:"GERAL"},{key:"abastecimento",label:"ABASTECIMENTO"},{key:"despesa",label:"DESPESA"},{key:"receita",label:"RECEITA"}],r=d("geral"),u=d("custo"),D=d([]),_=d([]),y=d(null),g=j(()=>D.value.filter(c=>c.id_veiculo===y.value)),A=d(0),w=d(0),B=d(0),R=d(0),f=d(0),P=d(0),V=d(null),q=d(null),C=d(1),k=d(0),F=d(0),I=d("--"),O=d("--"),x=d("--"),$=d("--"),L=d("--"),Y=j(()=>{if(!g.value.length)return{labels:[],datasets:[]};const c=[...g.value].sort((e,o)=>new Date(e.data_hora)-new Date(o.data_hora));if(u.value==="custo")return{labels:c.map(e=>new Date(e.data_hora).toLocaleDateString("pt-BR")),datasets:[{label:"Custo (R$)",data:c.map(e=>parseFloat(e.valor_total)||0),fill:!1,borderColor:"#00bcd4",backgroundColor:"#00bcd4",tension:.3}]};if(u.value==="consumo"){const e=c.filter(n=>n.tanque_cheio&&parseFloat(n.litros)>0&&n.quilometragem_atual>0);let o=[],p=[];for(let n=1;n<e.length;n++){const v=e[n].quilometragem_atual-e[n-1].quilometragem_atual,i=parseFloat(e[n].litros);v>0&&i>0&&(o.push(new Date(e[n].data_hora).toLocaleDateString("pt-BR")),p.push(v/i))}return{labels:o,datasets:[{label:"Consumo (km/L)",data:p,fill:!1,borderColor:"#4caf50",backgroundColor:"#4caf50",tension:.3}]}}else if(u.value==="distancia"){const e=c.filter(n=>n.tanque_cheio&&parseFloat(n.litros)>0&&n.quilometragem_atual>0);let o=[],p=[];for(let n=1;n<e.length;n++){const v=e[n].quilometragem_atual-e[n-1].quilometragem_atual;v>0&&(o.push(new Date(e[n].data_hora).toLocaleDateString("pt-BR")),p.push(v))}return{labels:o,datasets:[{label:"Distância (km)",data:p,fill:!1,borderColor:"#ff9800",backgroundColor:"#ff9800",tension:.3}]}}return{labels:[],datasets:[]}}),J={plugins:{legend:{labels:{color:"#2d2357",font:{size:14,weight:"bold"}}}},scales:{x:{ticks:{color:"#2d2357"},grid:{color:"#eee"}},y:{ticks:{color:"#2d2357"},grid:{color:"#eee"}}}};return at(async()=>{try{const[c,e]=await Promise.all([N.get("/api/fuelings"),N.get("/api/vehicles")]);D.value=Array.isArray(c.data)?c.data:[],_.value=Array.isArray(e.data)?e.data:[],_.value.length&&(y.value=_.value[0].id)}catch{}}),st([g,y],()=>{A.value=g.value.length;const c=g.value.map(i=>new Date(i.data_hora)).sort((i,m)=>i-m);V.value=c[0],q.value=c[c.length-1],C.value=c.length>1?Math.max(1,Math.ceil((q.value-V.value)/(1e3*60*60*24))):1,w.value=g.value.reduce((i,m)=>i+(parseFloat(m.valor_total)||0),0);const e=g.value.map(i=>i.quilometragem_atual).filter(Boolean).sort((i,m)=>i-m);f.value=e.length>1?e[e.length-1]-e[0]:0,B.value=C.value>0?w.value/C.value:0,R.value=f.value>0?w.value/f.value:0,P.value=C.value>0?f.value/C.value:0,k.value=w.value,F.value=g.value.reduce((i,m)=>i+(parseFloat(m.litros)||0),0);const o=g.value.filter(i=>i.tanque_cheio&&parseFloat(i.litros)>0&&i.quilometragem_atual>0).sort((i,m)=>i.quilometragem_atual-m.quilometragem_atual);let p=0,n=0,v=[];for(let i=1;i<o.length;i++){const m=o[i].quilometragem_atual-o[i-1].quilometragem_atual,E=parseFloat(o[i].litros);m>0&&E>0&&(p+=m,n+=E,v.push(m/E))}I.value=p>0&&n>0?(p/n).toLocaleString("pt-BR",{minimumFractionDigits:3,maximumFractionDigits:3}):"--",O.value=v.length?v[v.length-1].toLocaleString("pt-BR",{minimumFractionDigits:3,maximumFractionDigits:3}):"--",x.value=v.length?Math.max(...v).toLocaleString("pt-BR",{minimumFractionDigits:3,maximumFractionDigits:3}):"--",$.value=v.length?Math.min(...v).toLocaleString("pt-BR",{minimumFractionDigits:3,maximumFractionDigits:3}):"--",L.value=f.value>0?(k.value/f.value).toLocaleString("pt-BR",{minimumFractionDigits:3,maximumFractionDigits:3}):"--"},{immediate:!0}),(c,e)=>(h(),b(M,null,[t("div",ft,[e[3]||(e[3]=t("div",{class:"reports-header-title-row"},[t("span",{class:"reports-header-title"},"Relatórios"),t("i",{class:"pi pi-filter reports-header-filter"})],-1)),t("div",ht,[(h(),b(M,null,K(a,o=>t("div",{key:o.key,class:it(["reports-tab",{active:r.value===o.key}]),onClick:p=>r.value=o.key},l(o.label),11,bt)),64))]),_.value.length?(h(),b("div",_t,[e[2]||(e[2]=t("label",{for:"vehicle",style:{"font-weight":"600","margin-right":"0.5rem"}},"Veículo:",-1)),U(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>y.value=o),id:"vehicle",class:"reports-dropdown"},[(h(!0),b(M,null,K(_.value,o=>(h(),b("option",{key:o.id,value:o.id},l(o.nome_veiculo||o.nome)+" - "+l(o.placa),9,yt))),128))],512),[[z,y.value]])])):G("",!0)]),t("div",Dt,[r.value==="geral"?(h(),b("div",wt,[t("div",Rt,[e[7]||(e[7]=t("div",{class:"reports-card-title"},"Custo",-1)),t("div",Ct,[t("div",null,[e[4]||(e[4]=t("div",{class:"reports-card-label"},"Total",-1)),t("div",Ft,"R$ "+l(w.value.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})),1)]),t("div",null,[e[5]||(e[5]=t("div",{class:"reports-card-label"},"Por dia",-1)),t("div",St,"R$ "+l(B.value.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})),1)]),t("div",null,[e[6]||(e[6]=t("div",{class:"reports-card-label"},"Por km",-1)),t("div",kt,"R$ "+l(R.value>0?R.value.toLocaleString("pt-BR",{minimumFractionDigits:3,maximumFractionDigits:3}):"--"),1)])])]),t("div",Lt,[e[10]||(e[10]=t("div",{class:"reports-card-title"},"Distância",-1)),t("div",Bt,[t("div",null,[e[8]||(e[8]=t("div",{class:"reports-card-label"},"Total",-1)),t("div",Pt,l(f.value>0?f.value.toLocaleString("pt-BR"):"--")+" km",1)]),t("div",null,[e[9]||(e[9]=t("div",{class:"reports-card-label"},"Média diária",-1)),t("div",Ot,l(P.value>0?P.value.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):"--")+" km",1)])])]),t("div",xt,[e[12]||(e[12]=t("div",{class:"reports-card-title"},"Registros",-1)),t("div",$t,[t("div",null,[e[11]||(e[11]=t("div",{class:"reports-card-label"},"Total",-1)),t("div",Et,l(A.value),1)])])]),t("div",Mt,[U(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>u.value=o),class:"reports-dropdown"},e[13]||(e[13]=[t("option",{value:"custo"},"Custo",-1),t("option",{value:"consumo"},"Consumo",-1),t("option",{value:"distancia"},"Distância",-1)]),512),[[z,u.value]])]),t("div",At,[rt(ot(W),{type:"line",data:Y.value,options:J,style:{"min-height":"220px"}},null,8,["data"])])])):r.value==="abastecimento"?(h(),b("div",Vt,[e[30]||(e[30]=t("div",{class:"reports-section-title abastecimento"},"Custo",-1)),t("div",qt,[t("div",It,[t("div",null,[e[14]||(e[14]=t("div",{class:"reports-card-label"},"Total",-1)),t("div",Tt,"R$ "+l(k.value.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})),1)]),t("div",null,[e[15]||(e[15]=t("div",{class:"reports-card-label"},"Por dia",-1)),t("div",jt,"R$ "+l(B.value.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})),1)]),t("div",null,[e[16]||(e[16]=t("div",{class:"reports-card-label"},"Por km",-1)),t("div",Nt,"R$ "+l(R.value>0?R.value.toLocaleString("pt-BR",{minimumFractionDigits:3,maximumFractionDigits:3}):"--"),1)])])]),e[31]||(e[31]=t("div",{class:"reports-section-title abastecimento"},"Combustível",-1)),t("div",Kt,[t("div",Ut,[t("div",null,[e[17]||(e[17]=t("div",{class:"reports-card-label"},"Volume total",-1)),t("div",zt,l(F.value>0?F.value.toLocaleString("pt-BR",{minimumFractionDigits:3,maximumFractionDigits:3}):"--")+" L",1)]),t("div",null,[e[18]||(e[18]=t("div",{class:"reports-card-label"},"Média geral",-1)),t("div",Gt,l(I.value)+" km/L",1)])]),t("div",Ht,[t("div",null,[e[19]||(e[19]=t("div",{class:"reports-card-label"},"ÚLTIMA",-1)),t("div",Qt,l(O.value)+" km/L",1)]),e[20]||(e[20]=t("div",{class:"reports-card-label maior"},"MAIOR",-1)),t("div",Wt,l(x.value)+" km/L",1),e[21]||(e[21]=t("div",{class:"reports-card-label menor"},"MENOR",-1)),t("div",Yt,l($.value)+" km/L",1)])]),e[32]||(e[32]=t("div",{class:"reports-section-title abastecimento"},"Gas. Comum",-1)),t("div",Jt,[t("div",Xt,[t("div",null,[e[22]||(e[22]=t("div",{class:"reports-card-label"},"Custo total",-1)),t("div",Zt,"R$ "+l(k.value.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})),1)]),t("div",null,[e[23]||(e[23]=t("div",{class:"reports-card-label"},"Volume total",-1)),t("div",te,l(F.value>0?F.value.toLocaleString("pt-BR",{minimumFractionDigits:3,maximumFractionDigits:3}):"--")+" L",1)])]),t("div",ee,[t("div",null,[e[24]||(e[24]=t("div",{class:"reports-card-label"},"ÚLTIMA",-1)),t("div",ae,l(O.value)+" km/L",1)]),e[25]||(e[25]=t("div",{class:"reports-card-label maior"},"MAIOR",-1)),t("div",se,l(x.value)+" km/L",1),e[26]||(e[26]=t("div",{class:"reports-card-label menor"},"MENOR",-1)),t("div",re,l($.value)+" km/L",1)]),t("div",oe,[t("div",null,[e[27]||(e[27]=t("div",{class:"reports-card-label"},"Custo / Km",-1)),t("div",ie,"R$ "+l(L.value),1)]),e[28]||(e[28]=t("div",{class:"reports-card-label menor"},"MENOR",-1)),t("div",le,"R$ "+l(L.value),1),e[29]||(e[29]=t("div",{class:"reports-card-label maior"},"MAIOR",-1)),t("div",ne,"R$ "+l(L.value),1)])])])):G("",!0)])],64))}},ce=et(ue,[["__scopeId","data-v-71a51aa0"]]);export{ce as default};
