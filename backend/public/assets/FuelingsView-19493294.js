import{_ as I,b as N,r as y,v as U,d,e as p,h as $,i as E,m as A,f as o,t as k,j as V,k as O,V as D,W as L,n as B,X as T,u as z,o as W,R as F,l as c,Y as x,$ as P,a0 as q,g as j,a1 as H,w as X}from"./index-0b450a74.js";const K={class:"seletor-posto"},Q={key:0,class:"posto-selecionado mt-2"},Y={class:"posto-info"},J={class:"font-bold"},Z={class:"posto-endereco text-sm text-gray-600"},ee={class:"content-wrapper"},oe={class:"map-container"},te={class:"stations-list"},le={class:"stations-list-content"},ae={key:0,class:"station-item"},se=["onClick"],ie={class:"station-name"},ne={class:"station-address"},re={key:0,class:"station-distance"},ue={__name:"SeletorPosto",emits:["select"],setup(G,{emit:t}){const v=N(),m=y(!1),M=y(null),u=y(null),f=y([]),g=y([]),_=y(null),s=(i,a)=>{const w=(a.lat-i.lat)*Math.PI/180,b=(a.lng-i.lng)*Math.PI/180,S=Math.sin(w/2)*Math.sin(w/2)+Math.cos(i.lat*Math.PI/180)*Math.cos(a.lat*Math.PI/180)*Math.sin(b/2)*Math.sin(b/2);return 6371*(2*Math.atan2(Math.sqrt(S),Math.sqrt(1-S)))},e=()=>{if(M.value){if(!navigator.geolocation){console.error("Geolocalização não suportada pelo seu navegador");return}navigator.geolocation.getCurrentPosition(i=>{const a={lat:i.coords.latitude,lng:i.coords.longitude};u.value=new google.maps.Map(M.value,{center:a,zoom:14,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1}),new google.maps.Marker({position:a,map:u.value,title:"Você está aqui",icon:{path:google.maps.SymbolPath.CIRCLE,scale:10,fillColor:"#4285F4",fillOpacity:1,strokeColor:"#ffffff",strokeWeight:2}});const n=new google.maps.places.PlacesService(u.value),w={location:a,radius:2e3,keyword:"Posto de combustível",language:"pt-BR"};n.nearbySearch(w,(b,S)=>{S===google.maps.places.PlacesServiceStatus.OK&&b?(f.value.forEach(r=>r.setMap(null)),f.value=[],g.value=[],b.forEach(r=>{r.distance=s(a,{lat:r.geometry.location.lat(),lng:r.geometry.location.lng()})}),b.sort((r,C)=>r.distance-C.distance),b.forEach(r=>{const C=new google.maps.Marker({position:r.geometry.location,map:u.value,title:r.name,icon:{path:google.maps.SymbolPath.CIRCLE,scale:8,fillColor:"#FF0000",fillOpacity:1,strokeColor:"#ffffff",strokeWeight:2}});C.addListener("click",()=>{l(r)}),f.value.push(C),g.value.push(r)})):(console.error("Não foi possível encontrar postos próximos:",S),g.value=[])})},i=>{console.error("Erro ao obter localização:",i.message)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})}},l=i=>{_.value={nome:i.name,endereco:i.vicinity,latitude:i.geometry.location.lat(),longitude:i.geometry.location.lng()},R("select",_.value),m.value=!1,v.add({severity:"success",summary:"Posto selecionado",detail:`Você selecionou o posto ${i.name}`,life:3e3})},h=()=>new Promise((i,a)=>{if(window.google){i();return}const n=document.createElement("script");n.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD2lfwyGnehINoCdBUCPIypiaOx_f4mwXk&libraries=places",n.async=!0,n.defer=!0,n.onload=i,n.onerror=a,document.head.appendChild(n)});U(m,async i=>{if(i)try{await h(),setTimeout(()=>{e()},100)}catch(a){console.error("Erro ao carregar o Google Maps:",a)}else u.value&&(u.value=null,f.value=[],g.value=[])});const R=t;return(i,a)=>(d(),p("div",K,[$(E(A),{label:"Mostrar Postos Próximos",icon:"pi pi-map-marker",onClick:a[0]||(a[0]=n=>m.value=!0),class:"w-full"}),_.value?(d(),p("div",Q,[o("div",Y,[a[2]||(a[2]=o("i",{class:"pi pi-check-circle text-green-500 mr-2"},null,-1)),o("span",J,k(_.value.nome),1)]),o("div",Z,k(_.value.endereco),1)])):V("",!0),$(E(T),{visible:m.value,"onUpdate:visible":a[1]||(a[1]=n=>m.value=n),modal:!0,style:{width:"90vw",maxWidth:"1200px"},header:"Postos de Gasolina Próximos",breakpoints:{"960px":"75vw","641px":"100vw"}},{default:O(()=>[o("div",ee,[o("div",oe,[o("div",{id:"map",ref_key:"mapContainer",ref:M},null,512)]),o("div",te,[a[3]||(a[3]=o("h3",null,"Postos Encontrados",-1)),o("div",le,[g.value.length===0?(d(),p("div",ae," Nenhum posto encontrado nesta área. ")):V("",!0),(d(!0),p(D,null,L(g.value,(n,w)=>(d(),p("div",{key:n.place_id,class:B(["station-item",{"nearest-station":w===0}]),onClick:b=>l(n)},[o("div",ie,k(n.name),1),o("div",ne,k(n.vicinity||"Endereço não disponível"),1),n.distance?(d(),p("div",re,k(n.distance.toFixed(1))+" km ",1)):V("",!0)],10,se))),128))])])])]),_:1},8,["visible"])]))}},ce=I(ue,[["__scopeId","data-v-3bf16e14"]]);const de={class:"fueling-main"},pe={class:"fueling-row"},ve={class:"fueling-col"},me={class:"fueling-col"},fe={class:"fueling-row fueling-row-3"},ge={class:"fueling-col"},be=["value"],ye={class:"fueling-col"},_e=["value"],he={class:"fueling-col"},we=["value"],xe={class:"custom-toggle-switch"},ke=["value"],Me={__name:"FuelingsView",setup(G){const t=y({data:"",hora:"",quilometragem:"",combustivel:"",preco:"",valor:"",litros:"",completo:!1,postoSelecionado:null,veiculo:""}),v=y([]),m=N(),M=z();W(async()=>{const s=new Date;t.value.data=s.toISOString().slice(0,10),t.value.hora=s.toTimeString().slice(0,5);try{const e=await F.get("/api/vehicles");v.value=e.data,t.value.veiculo=v.value.length?v.value[v.value.length-1].id:""}catch{v.value=[]}});function u(s){if(s==null||s==="")return"";const e=Number(String(s).replace(/[^\d,\.]/g,"").replace(",","."));return isNaN(e)?"":e.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}function f(s,e){let l=e.target.value.replace(/\D/g,"");l||(l="0"),l=l.slice(0,8);let h=(parseInt(l,10)/100).toFixed(2);e.target.value=h.replace(".",","),t.value[s]=parseFloat(h),g(s)}function g(s){const{preco:e,valor:l,litros:h}=t.value;s==="preco"&&e&&l||s==="valor"&&e&&l?t.value.litros=+(l/e).toFixed(2):s==="litros"&&e&&h&&(t.value.valor=+(e*h).toFixed(2))}async function _(){var s,e;try{const l={data_hora:t.value.data+" "+t.value.hora,quilometragem_atual:t.value.quilometragem,combustivel:t.value.combustivel,preco_litro:t.value.preco,valor_total:t.value.valor,litros:t.value.litros,tanque_cheio:t.value.completo,posto:t.value.postoSelecionado?t.value.postoSelecionado.nome:"",id_veiculo:t.value.veiculo};await F.post("/api/fuelings",l),m.add({severity:"success",summary:"Sucesso",detail:"Abastecimento salvo!",life:3e3}),M.push("/fuelings")}catch(l){m.add({severity:"error",summary:"Erro",detail:((e=(s=l.response)==null?void 0:s.data)==null?void 0:e.error)||"Erro ao salvar abastecimento",life:4e3})}}return(s,e)=>(d(),p("div",de,[e[18]||(e[18]=o("h2",{class:"fueling-title"},"Abastecimento",-1)),o("div",pe,[o("div",ve,[e[10]||(e[10]=o("label",{class:"fueling-label",for:"data"},[o("i",{class:"pi pi-calendar"}),c(" Data")],-1)),x(o("input",{id:"data","onUpdate:modelValue":e[0]||(e[0]=l=>t.value.data=l),class:"fueling-input",type:"date"},null,512),[[P,t.value.data]])]),o("div",me,[e[11]||(e[11]=o("label",{class:"fueling-label",for:"hora"},[o("i",{class:"pi pi-clock"}),c(" Hora")],-1)),x(o("input",{id:"hora","onUpdate:modelValue":e[1]||(e[1]=l=>t.value.hora=l),class:"fueling-input",type:"time"},null,512),[[P,t.value.hora]])])]),e[19]||(e[19]=o("label",{class:"fueling-label",for:"quilometragem"},[o("i",{class:"pi pi-tachometer"}),c(" Quilometragem")],-1)),x(o("input",{id:"quilometragem","onUpdate:modelValue":e[2]||(e[2]=l=>t.value.quilometragem=l),class:"fueling-input",type:"number",min:"0",placeholder:"Digite a quilometragem"},null,512),[[P,t.value.quilometragem]]),e[20]||(e[20]=o("label",{class:"fueling-label",for:"combustivel"},[o("i",{class:"pi pi-gas-pump"}),c(" Combustível")],-1)),x(o("select",{id:"combustivel","onUpdate:modelValue":e[3]||(e[3]=l=>t.value.combustivel=l),class:"fueling-input"},e[12]||(e[12]=[j('<option value="" data-v-a4bffbde>Selecione</option><option value="Gasolina" data-v-a4bffbde>Gasolina</option><option value="Etanol" data-v-a4bffbde>Etanol</option><option value="Diesel" data-v-a4bffbde>Diesel</option><option value="GNV" data-v-a4bffbde>GNV</option><option value="Flex" data-v-a4bffbde>Flex</option><option value="Outro" data-v-a4bffbde>Outro</option>',7)]),512),[[q,t.value.combustivel]]),o("div",fe,[o("div",ge,[e[13]||(e[13]=o("label",{class:"fueling-label",for:"preco"},[o("i",{class:"pi pi-money-bill"}),c(" Preço/L")],-1)),o("input",{id:"preco",value:t.value.preco!==""?u(t.value.preco):"",class:"fueling-input",type:"text",inputmode:"decimal",pattern:"[0-9]*",placeholder:"0,00",onInput:e[4]||(e[4]=l=>f("preco",l))},null,40,be)]),o("div",ye,[e[14]||(e[14]=o("label",{class:"fueling-label",for:"valor"},[o("i",{class:"pi pi-wallet"}),c(" Valor total")],-1)),o("input",{id:"valor",value:t.value.valor!==""?u(t.value.valor):"",class:"fueling-input",type:"text",inputmode:"decimal",pattern:"[0-9]*",placeholder:"0,00",onInput:e[5]||(e[5]=l=>f("valor",l))},null,40,_e)]),o("div",he,[e[15]||(e[15]=o("label",{class:"fueling-label",for:"litros"},[o("i",{class:"pi pi-filter"}),c(" Litros")],-1)),o("input",{id:"litros",value:t.value.litros!==""?u(t.value.litros):"",class:"fueling-input",type:"text",inputmode:"decimal",pattern:"[0-9]*",placeholder:"0,00",onInput:e[6]||(e[6]=l=>f("litros",l))},null,40,we)])]),o("div",xe,[e[16]||(e[16]=o("span",{class:"toggle-label-text"},[o("i",{class:"pi pi-gas-pump"}),c(" Encheu o tanque?")],-1)),x(o("input",{type:"checkbox",id:"toggle-tanque","onUpdate:modelValue":e[7]||(e[7]=l=>t.value.completo=l)},null,512),[[H,t.value.completo]]),e[17]||(e[17]=o("label",{for:"toggle-tanque"},null,-1))]),e[21]||(e[21]=o("label",{class:"fueling-label",for:"posto"},[o("i",{class:"pi pi-map-marker"}),c(" Posto de combustível")],-1)),$(ce,{modelValue:t.value.postoSelecionado,"onUpdate:modelValue":e[8]||(e[8]=l=>t.value.postoSelecionado=l)},null,8,["modelValue"]),e[22]||(e[22]=o("label",{class:"fueling-label",for:"veiculo"},[o("i",{class:"pi pi-car"}),c(" Veículo")],-1)),x(o("select",{id:"veiculo","onUpdate:modelValue":e[9]||(e[9]=l=>t.value.veiculo=l),class:"fueling-input"},[(d(!0),p(D,null,L(v.value,l=>(d(),p("option",{key:l.id,value:l.id},k(l.nome_veiculo),9,ke))),128))],512),[[q,t.value.veiculo]]),o("button",{class:"fueling-btn",onClick:X(_,["prevent"])},"SALVAR")]))}},Ce=I(Me,[["__scopeId","data-v-a4bffbde"]]);export{Ce as default};
